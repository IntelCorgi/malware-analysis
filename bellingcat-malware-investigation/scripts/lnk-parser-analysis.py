import os
import sys
import hashlib
import LnkParse3

def extract_data_from_lnk(lnk_path):
    with open(lnk_path, 'rb') as lnk_file:
        lnk = LnkParse3.lnk_file(lnk_file)
        print("File Hash:", hashlib.sha256(lnk_path.encode()).hexdigest())
        lnk.print_json()
        print("============================================================================")

def main(target_dir):
    if not os.path.isdir(target_dir):
        print("Invalid target directory.")
        return

    lnk_files = [f for f in os.listdir(target_dir) if f.endswith('.lnk')]
    if not lnk_files:
        print("No LNK files found in the target directory.")
        return

    for lnk_file in lnk_files:
        lnk_path = os.path.join(target_dir, lnk_file)
        extract_data_from_lnk(lnk_path)

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python3-parser-analysis.py <<target dir>>")
    else:
        target_dir = sys.argv[1]
        main(target_dir)
